{"version":3,"sources":["../src/Animator.js"],"names":["visitor","GraphsVisitor","Animator","keyframe","visit","bind","time","bezierCurve","BezierCurve","keyframeGraphs","updateKeyframeGraphs","length","push","from","graph","x","controls","to","result","nodes","cloneNodes","slice","resultNode","pop","name","elapsedTime","startAt","animationDuration","endAt","timeWithEasing","easing","points","map","node","value","setPoints","valueAt","Array","isArray","children","setCallback","visitDown","toString"],"mappings":"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","sourcesContent":["import BezierCurve from \"./BezierCurve.js\";\nimport GraphsVisitor from \"./GraphsVisitor.js\";\n\nconst visitor = new GraphsVisitor();\n\nexport default class Animator {\n  constructor(keyframe) {\n    this.keyframe = keyframe;\n    this.visit = this.visit.bind(this);\n    this.time = 0;\n    this.bezierCurve = new BezierCurve([]);\n    this.keyframeGraphs = [];\n    this.updateKeyframeGraphs();\n  }\n\n  updateKeyframeGraphs() {\n    this.keyframeGraphs.length = 0;\n    this.keyframeGraphs.push(this.keyframe.from.graph);\n\n    for (let x = 0; x < this.keyframe.controls.length; x++) {\n      this.keyframeGraphs.push(this.keyframe.controls[x].graph);\n    }\n\n    this.keyframeGraphs.push(this.keyframe.to.graph);\n    this.keyframeGraphs.push(this.keyframe.result.graph);\n  }\n\n  visit(nodes) {\n    const cloneNodes = nodes.slice();\n    const resultNode = cloneNodes.pop();\n    const time = this.time;\n\n    if (cloneNodes[0].name === \"number\") {\n      const elapsedTime = time - this.keyframe.startAt;\n      const animationDuration = this.keyframe.endAt - this.keyframe.startAt;\n      const timeWithEasing = this.keyframe.easing(\n        elapsedTime / animationDuration\n      );\n\n      const points = cloneNodes.map((node) => node.value);\n\n      this.bezierCurve.setPoints(points);\n      resultNode.value = this.bezierCurve.valueAt(timeWithEasing);\n    } else {\n      if (!Array.isArray(resultNode.children)) {\n        if (time >= this.keyframe.startAt) {\n          resultNode.value = cloneNodes[cloneNodes.length - 1].value;\n        } else {\n          resultNode.value = cloneNodes[0].value;\n        }\n      }\n    }\n  }\n\n  update(time) {\n    this.updateKeyframeGraphs();\n    this.time = time;\n\n    visitor.setCallback(this.visit);\n    visitor.visitDown(this.keyframeGraphs, true);\n\n    const value = this.keyframe.result.graph.toString();\n    this.keyframe.result.value = value;\n\n    return this.keyframe.result;\n  }\n}\n"],"file":"Animator.js"}