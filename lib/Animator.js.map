{"version":3,"sources":["../src/Animator.js"],"names":["visitor","GraphsVisitor","Animator","animation","visit","bind","progress","bezierCurve","BezierCurve","animationGraphs","createAnimationGraphs","length","push","from","graph","x","controls","to","result","nodes","cloneNodes","slice","resultNode","pop","name","relativeProgress","startAt","animationDuration","endAt","progressWithEasing","easing","points","map","node","value","setPoints","valueAt","Array","isArray","children","setCallback","visitDown","toString"],"mappings":"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","sourcesContent":["import BezierCurve from \"./BezierCurve.js\";\nimport GraphsVisitor from \"./GraphsVisitor.js\";\n\nconst visitor = new GraphsVisitor();\n\nexport default class Animator {\n  constructor(animation) {\n    this.animation = animation;\n    this.visit = this.visit.bind(this);\n    this.progress = 0;\n    this.bezierCurve = new BezierCurve([]);\n    this.animationGraphs = [];\n    this.createAnimationGraphs();\n  }\n\n  createAnimationGraphs() {\n    this.animationGraphs.length = 0;\n\n    this.animationGraphs.push(this.animation.from.graph);\n\n    for (let x = 0; x < this.animation.controls.length; x++) {\n      this.animationGraphs.push(this.animation.controls[x].graph);\n    }\n\n    this.animationGraphs.push(this.animation.to.graph);\n    this.animationGraphs.push(this.animation.result.graph);\n  }\n\n  visit(nodes) {\n    const cloneNodes = nodes.slice();\n    const resultNode = cloneNodes.pop();\n    const progress = this.progress;\n\n    if (cloneNodes[0].name === \"number\") {\n      const relativeProgress = progress - this.animation.startAt;\n      const animationDuration = this.animation.endAt - this.animation.startAt;\n      const progressWithEasing =\n        this.animation.easing(relativeProgress) * animationDuration;\n\n      const points = cloneNodes.map((node) => node.value);\n\n      this.bezierCurve.setPoints(points);\n      resultNode.value = this.bezierCurve.valueAt(progressWithEasing);\n    } else {\n      if (!Array.isArray(resultNode.children)) {\n        if (progress >= this.animation.startAt) {\n          resultNode.value = cloneNodes[cloneNodes.length - 1].value;\n        } else {\n          resultNode.value = cloneNodes[0].value;\n        }\n      }\n    }\n  }\n\n  render(progress) {\n    this.progress = progress;\n\n    visitor.setCallback(this.visit);\n    visitor.visitDown(this.animationGraphs, true);\n\n    const value = this.animation.result.graph.toString();\n    this.animation.result.value = value;\n\n    return this.animation.result;\n  }\n}\n"],"file":"Animator.js"}